public class BoxAuthorisationController {
    
    public String authCode {set;get;}
    public String body {set;get;}
    public List<MyOwnDataType> dataList{set;get;}
    public PageReference getAuthenticated(){
        return new PageReference('https://account.box.com/api/oauth2/authorize?client_id=wl8d1h3ckjoqo5nydgtjmy5pd5pvxif3&response_type=code');
    }
    
    
    public void tradeAuthCode(){
        dataList = new List<MyOwnDataType>();
        //1. Extract the auth code 
        authCode = ApexPages.currentpage().getparameters().get('code');
        
        //2. Instantiate HTTP Class
        Http h = new Http();
        
        //3. Frame the request for a POST method
        HttpRequest req = new HttpRequest();
        req.setEndpoint('https://api.box.com/oauth2/token');
        req.setMethod('POST');
        req.setHeader('Accepts', 'application/json');
        req.setBody('grant_type=authorization_code&client_id=wl8d1h3ckjoqo5nydgtjmy5pd5pvxif3&client_secret=oy4gutBElMQOJCM3fUd6zG6VtSY7lYrd&code='+authCode);
        
        
        //4. Handle the response
        HttpResponse res = h.send(req);
        
        
        fromJSON d = (fromJSON)JSON.deserialize(res.getBody(), fromJSON.class);
        
        
        
        body = getFilesInfo(d.access_token);
    	file2folder e = (file2folder)JSON.deserialize(body, file2folder.class);
        for(Integer i = 0; i < e.item_collection.entries.size(); i++){
            System.debug(i+' '+e.item_collection.entries[i].name);
            dataList.add(new MyOwnDataType(e.item_collection.entries[i].name));
             
        }
    
    }

    
    public String getFilesInfo(String access_token){
        Http h = new Http();
        
        HttpRequest req = new HttpRequest();
        req.setEndpoint('https://api.box.com/2.0/folders/137165355759');
        req.setMethod('GET');
        req.setHeader('Accepts', 'application/json');
        req.setHeader('Authorization', 'Bearer '+access_token);
        
        HttpResponse res = h.send(req);
        return res.getBody();
        
    }
    public class MyOwnDataType{
        public String name{set;get;}
        
        
         public MyOwnDataType(String name){
            this.name=name;
         }
    }
    
    //
//Generated by AdminBooster
//

public class file2folder{
	public String type;	//folder
	public String id;	//137165355759
	public String sequence_id;	//0
	public String etag;	//0
	public String name;	//Document
	public String created_at;	//2021-05-11T05:21:02-07:00
	public String modified_at;	//2021-05-12T04:53:00-07:00
	public String description;	//
	public Integer size;	//761354
	public cls_path_collection path_collection;
	public cls_created_by created_by;
	public cls_modified_by modified_by;
	public cls_trashed_at trashed_at;
	public cls_purged_at purged_at;
	public String content_created_at;	//2021-05-11T05:21:02-07:00
	public String content_modified_at;	//2021-05-12T04:53:00-07:00
	public cls_owned_by owned_by;
	public cls_shared_link shared_link;
	public cls_folder_upload_email folder_upload_email;
	public cls_parent parent;
	public String item_status;	//active
	public cls_item_collection item_collection;
	
	
}
    class cls_path_collection {
		public Integer total_count;	//1
		public cls_entries[] entries;
	}
	class cls_entries {
		public String type;	//file
		public String id;	//809746204892
		public cls_file_version file_version;
		public String sequence_id;	//0
		public String etag;	//0
		public String sha1;	//6127a1c8d4ea5ea412672fd9a92ad57080105512
		public String name;	//Milan's Resume (1).pdf
	}
	class cls_sequence_id {
	}
	class cls_etag {
	}
	class cls_created_by {
		public String type;	//user
		public String id;	//16047608456
		public String name;	//Milan Agarwal
		public String login;	//1713310114@niet.co.in
	}
	class cls_modified_by {
		public String type;	//user
		public String id;	//16047608456
		public String name;	//Milan Agarwal
		public String login;	//1713310114@niet.co.in
	}
	class cls_trashed_at {
	}
	class cls_purged_at {
	}
	class cls_owned_by {
		public String type;	//user
		public String id;	//16047608456
		public String name;	//Milan Agarwal
		public String login;	//1713310114@niet.co.in
	}
	class cls_shared_link {
	}
	class cls_folder_upload_email {
	}
	class cls_parent {
		public String type;	//folder
		public String id;	//0
		public cls_sequence_id sequence_id;
		public cls_etag etag;
		public String name;	//All Files
	}
	class cls_item_collection {
		public Integer total_count;	//2
		public cls_entries[] entries;
		public Integer offset;	//0
		public Integer limit_x;	//100
		public cls_order[] order;
	}
	class cls_file_version {
		public String type;	//file_version
		public String id;	//866686960892
		public String sha1;	//6127a1c8d4ea5ea412672fd9a92ad57080105512
	}
	class cls_order {
		public String by_x;	//type
		public String direction;	//ASC
	}
    public class fromJSON{
        public String access_token;	//JPVuHLuiYHQYccPLDSvajL9LEnTH2RZ3
        public Integer expires_in;	//3630
        public cls_restricted_to[] restricted_to;
        public String refresh_token;	//DwUSgjIc4YCusrb03E1zvN8MAPnEWjeZdlTf2qkg9bGYTyRlx5D1xrgHUbBKmTMJ
        public String token_type;	//bearer
        
        
    }
    class cls_restricted_to {
    }
 }